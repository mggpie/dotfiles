---
# =============================================================================
# SSD and TRIM Configuration
# =============================================================================
# DISABLED: crypttab/dracut modifications may cause boot issues
# TODO: Re-enable after debugging boot problem

- name: Install util-linux for fstrim
  ansible.builtin.command:
    cmd: xbps-install -Sy util-linux
  changed_when: true

- name: Check if running on LUKS
  ansible.builtin.stat:
    path: /dev/mapper/voidcrypt
  register: luks_device

- name: Skip crypttab/dracut modification (preserve working boot)
  ansible.builtin.debug:
    msg: "Skipping crypttab/dracut modifications to preserve working boot config"

# fstrim is handled by cron job in base role
- name: Verify fstrim is available
  ansible.builtin.command:
    cmd: which fstrim
  register: fstrim_check
  changed_when: false
  failed_when: fstrim_check.rc != 0
