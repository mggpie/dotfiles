---
# Fish shell installation and configuration

- name: Install Fish shell and tools
  community.general.xbps:
    name:
      - fish-shell
      - bash
      - bash-completion
      - fzf
      - eza
      - bat
      - fd
      - ripgrep
    state: present
  tags: [fish, shell]

- name: Install Fisher (Fish plugin manager)
  community.general.xbps:
    name: fisher
    state: present
  tags: [fish, shell]

- name: Install Tide prompt
  become_user: "{{ username }}"
  shell: fish -c "fisher install IlanCosman/tide@v6"
  args:
    creates: "{{ user_home }}/.config/fish/functions/tide.fish"
  tags: [fish, tide]

- name: Configure Tide prompt
  become_user: "{{ username }}"
  shell: |
    fish -c "tide configure --auto --style=Rainbow --prompt_colors='True color' --show_time='24-hour format' --rainbow_prompt_separators=Angled --powerline_prompt_heads=Sharp --powerline_prompt_tails=Flat --powerline_prompt_style='Two lines, character and frame' --prompt_connection=Solid --powerline_right_prompt_frame=No --prompt_connection_andor_frame_color=Darkest --prompt_spacing=Spaced --icons='Many icons' --transient=Yes"
  changed_when: true
  tags: [fish, tide]

- name: Deploy Fish config
  copy:
    src: config.fish
    dest: "{{ user_home }}/.config/fish/config.fish"
    owner: "{{ username }}"
    group: "{{ username }}"
    force: no
  tags: [fish, config]

- name: Set Fish as default shell
  user:
    name: "{{ username }}"
    shell: /usr/bin/fish
  tags: [fish, shell]
